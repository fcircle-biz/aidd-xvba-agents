# 備品貸出管理シート 設計書（VBA・フォームなし）

## 1. 概要

* **目的**：社内備品（PC・プロジェクタ・ツール等）の貸出・返却状況を一元管理し、利用履歴や在庫状況を可視化する。
* **特徴**：

  * UserFormは使用せず、Excelシートとボタンによる操作。
  * 貸出・返却は専用シートに記入→ボタンで登録。
  * 在庫状況と貸出中リストを自動集計。
  * 履歴を時系列で記録。

## 2. 対象環境

* Excel 2016以降（Windows）
* マクロ有効ブック（.xlsm）

## 3. シート構成

| シート名      | 用途                        |
| --------- | ------------------------- |
| Dashboard | 在庫状況・貸出中一覧・操作ボタン配置        |
| Items     | 備品マスタ（備品ID、名称、分類、保管場所、数量） |
| Lending   | 貸出・返却履歴（Excelテーブル）        |
| Input     | 貸出/返却登録用の入力シート            |
| \_Config  | 設定（貸出期間の上限日数、警告閾値など）      |

## 4. データモデル

### 4.1 備品マスタ（`Items`）

| 列名       | 型   | 必須 | 説明               |
| -------- | --- | -- | ---------------- |
| ItemID   | 数値  | ○  | 備品コード（主キー）       |
| ItemName | 文字列 | ○  | 備品名              |
| Category | 文字列 |    | 分類（PC/AV機器/文具など） |
| Location | 文字列 |    | 保管場所             |
| Quantity | 数値  | ○  | 総在庫数             |

### 4.2 貸出履歴（`Lending`）

| 列名         | 型   | 必須 | 説明             |
| ---------- | --- | -- | -------------- |
| RecordID   | 数値  | ○  | 連番（主キー）        |
| ItemID     | 数値  | ○  | 備品コード（Items参照） |
| ItemName   | 文字列 | ○  | 冗長保持（マスタ名コピー）  |
| Borrower   | 文字列 | ○  | 借用者氏名          |
| LendDate   | 日付  | ○  | 貸出日            |
| DueDate    | 日付  | ○  | 返却期限           |
| ReturnDate | 日付  |    | 実際の返却日         |
| Status     | 文字列 | ○  | 貸出中/返却済        |
| Remarks    | 文字列 |    | 備考欄            |

## 5. 操作方法

### 5.1 貸出登録

1. **Inputシート**に以下を入力

   * 備品ID
   * 借用者
   * 貸出日（省略時は今日）
   * 貸出期間（日数）
2. 「貸出登録」ボタン押下
   → `Lending` シート末尾にレコード追加
   → `Dashboard` 更新

### 5.2 返却登録

1. **Inputシート**に以下を入力

   * 備品ID
   * 借用者
   * 返却日（省略時は今日）
2. 「返却登録」ボタン押下
   → `Lending`で該当レコードを検索し、ReturnDateとStatusを更新
   → `Dashboard` 更新

## 6. 自動計算・集計仕様

* **貸出中件数**＝Status="貸出中" の件数
* **在庫数**＝`Items.Quantity` − 貸出中件数
* **期限超過件数**＝Today > DueDate AND Status="貸出中"
* `Dashboard` に一覧表示（条件付き書式で期限超過を赤表示）

## 7. VBAモジュール構成

* `modInit`：初期設定、名前定義の存在確認
* `modLending`：貸出登録・返却処理
* `modDashboard`：集計・表示更新
* `modUtils`：日付変換、エラーメッセージ表示、ログ処理

### 7.1 主なプロシージャ

```vb
'貸出登録
Public Sub RegisterLending()
    'Inputシートの値取得
    '必須項目チェック
    'Lendingシート末尾に追加
    'Dashboard更新
End Sub

'返却登録
Public Sub RegisterReturn()
    'Inputシートの値取得
    '該当レコード検索
    'ReturnDateとStatus更新
    'Dashboard更新
End Sub

'ダッシュボード更新
Public Sub UpdateDashboard()
    '貸出中件数、在庫数、期限超過件数を計算
    'セルに反映
End Sub
```

## 8. バリデーション

* 備品IDがマスタに存在するか
* 貸出中の同じ備品が在庫数を超えないか
* 返却時に貸出中レコードが存在するか
* 日付の整合（貸出日 ≤ 返却日）

## 9. エラー処理

* `On Error GoTo ErrHandler`
* ユーザー向けはMsgBoxで簡潔に表示
* 詳細はログシート（任意）

## 10. 将来拡張

* CSV出力
* 複数備品同時貸出
* メール通知（返却期限前リマインド）
* バーコード入力対応（スキャナ）
